<div class="mapa-container">
  <!-- Encabezado con filtros -->
  <div class="mapa-header">
    <h2>üåø Mapa de Biodiversidad Ecuador</h2>

    <div class="filtros">
      <div class="filter-group">
        <label for="region-select">Regi√≥n:</label>
        <select
          id="region-select"
          [(ngModel)]="regionSeleccionada"
          (change)="onRegionChange(regionSeleccionada)"
          class="form-select">
          <option value="Todas">Todas las regiones</option>
          <option value="Costa">Costa</option>
          <option value="Sierra">Sierra</option>
          <option value="Amazonia">Amazon√≠a</option>
          <option value="Galapagos">Gal√°pagos</option>
        </select>
      </div>

      <div class="especies-count">
        <span class="badge">{{ especiesFiltradas.length }} especies encontradas</span>
      </div>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="spinner"></div>
    <p>Cargando datos del mapa...</p>
  </div>

  <!-- Error -->
  <div *ngIf="error && !isLoading" class="error-container">
    <p>{{ error }}</p>
    <button (click)="cargarEspecies()" class="btn btn-retry">üîÑ Reintentar</button>
  </div>

  <!-- Mapa principal -->
  <div class="mapa-content" *ngIf="!isLoading && !error">
    <google-map
      [options]="mapOptions"
      [width]="'100%'"
      [height]="'600px'">

      <!-- Markers de especies -->
      <map-marker
        *ngFor="let marker of markers"
        [position]="marker.position"
        [title]="marker.title"
        [options]="marker.options"
        (mapClick)="onMarkerClick(marker)">
      </map-marker>
    </google-map>

    <!-- ‚úÖ LEYENDA ACTUALIZADA con nuevos colores -->
    <div class="leyenda">
      <h4>Estado de Conservaci√≥n</h4>

      <div class="leyenda-item">
        <span class="marker-dot rojo"></span>
        <span>Peligro Cr√≠tico</span>
      </div>

      <div class="leyenda-item">
        <span class="marker-dot naranja"></span>
        <span>En Peligro</span>
      </div>

      <div class="leyenda-item">
        <span class="marker-dot amarillo"></span>
        <span>Casi Amenazado</span>
      </div>

      <div class="leyenda-item">
        <span class="marker-dot azul"></span>
        <span>Vulnerable</span>
      </div>

      <div class="leyenda-item">
        <span class="marker-dot verde"></span>
        <span>Preocupaci√≥n Menor</span>
      </div>

      <div class="leyenda-item">
        <span class="marker-dot rosado"></span>
        <span>Extinto</span>
      </div>

      <div class="leyenda-item">
        <span class="marker-dot celeste"></span>
        <span>Extinto en Estado Silvestre</span>
      </div>

      <div class="leyenda-item">
        <span class="marker-dot morado"></span>
        <span>Datos Insuficientes</span>
      </div>

      <div class="leyenda-item">
        <span class="marker-dot gris"></span>
        <span>No Evaluado</span>
      </div>
    </div>
  </div>

  <!-- Panel de informaci√≥n de especie seleccionada -->
  <div *ngIf="especieSeleccionada" class="especie-info-panel">
    <div class="panel-header">
      <h3>{{ especieSeleccionada.nombre_vulgar }}</h3>
      <button (click)="cerrarInfoEspecie()" class="btn-close">&times;</button>
    </div>

    <div class="panel-content">
      <div class="especie-details">
        <p><strong>Nombre cient√≠fico:</strong> {{ especieSeleccionada.nombre_cientifico }}</p>
        <p><strong>Familia:</strong> {{ especieSeleccionada.familia }}</p>
        <p><strong>H√°bitat:</strong> {{ especieSeleccionada.habitat }}</p>
        <p><strong>Estado:</strong>
          <span class="status-badge" [style.background-color]="getStatusColor(especieSeleccionada.estado_conservacion)">
            {{ especieSeleccionada.estado_conservacion }}
          </span>
        </p>
        <p *ngIf="especieSeleccionada.descripcion"><strong>Descripci√≥n:</strong> {{ especieSeleccionada.descripcion }}</p>
        <p><strong>Coordenadas:</strong>
          {{ especieSeleccionada.coordenadas.latitud.toFixed(4) }},
          {{ especieSeleccionada.coordenadas.longitud.toFixed(4) }}
        </p>
      </div>
    </div>
  </div>
</div>
